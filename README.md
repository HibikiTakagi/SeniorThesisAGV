# 学部卒業論文
卒業研究のコードを共同編集・引継ぎができるようアップしました。 (2024/12/17 高木)  
※研究に使用していたものとは多少の差異がございます。  

実際に動かしてみたい場合は、[スタートガイド](#スタートガイド)を参照してください。  
お困りごとがあれば、まずは[質問](#質問)をご確認ください。

## 問題設定
- 6×6の無向グラフ(グリッド)上を3機のAGVが移動する。
- 各AGVはタスクを次々と処理しながらグラフ上を動く。
- 互いの衝突は無視する。
- 各タスクには荷物を受け取るpicking_nodeと、配達先のdelivery_nodeが設定されている。
- タスクは全部で27個事前に用意されている。
- picking_nodeに重複は無い。
- タスクは3個単位(パック単位)でAGVに割当てる。
- AGVは与えられた3つのタスクを、最短時間となる順に逐次処理する。
- 1パックが完了すると、次のパックの割当てが可能となる。
- 強化学習を用いたアプローチで、メイクスパン(最終完了時間)の最小化をめざす。

## 詰まっている点
- 強化学習の枠組みに落とし込むこと  
何を状態、行動として設定するか。(MDPを満たす必要がある。)
- 実装問題

## 案
- タスクパックの作成部分と、割当て部分(ジョブショップ問題の部分)を分割して考える。

## その他メモ
- 比較手法
- スケール
- 厳密な計算量

## スタートガイド
まずはGitHubにアクセスするためのSSHキーが正しく設定されているか確認してください。
その後、以下の手順に従って環境を構築・実行してみてください。
※Dockerのイメージ名やコンテナ名、JUPYTER_TOKEN等は適宜ファイルの中身を編集して、自分用に書き変えるようにしてください。

- ローカルにクローン
```
> git clone git@github.com:HibikiTakagi/SeniorThesisAGV.git
```
- Dockerを利用するために移動
```
> cd ./SeniorThesisAGV/docker_setup
```
- Dockerイメージの作成と確認  
```
> ./make_docker_image.sh
> docker images | grep <name>
```
- Dockerコンテナの作成と確認  
```
> ./start_docker_container.sh
> docker ps | grep <name>
```
- コンテナ内へ入る  
※VSCodeを利用している場合は、拡張機能でも簡単にコンテナ内へ入られるそうです。
```
> ./enter_docker_container.sh
```
- コンテナ内で不足ファイルの取得  
今後pipインストールを行いたい場合は、こちらのinitial.shに追記していってください。(Dockerで管理している意味が無くなってしまうので、コンテナ外でインストールしないでください。)
```
# ./initial.sh
```
- Python(Numpy)の確認
```
# python3.10 numpy_test.py
[1 2 3]
```

以上で初期設定は終了になります。後は様々なコードを実行してみたり、自由に編集してみたりしてください。  

## 質問
**Q. スクリプトファイル(shファイル)の実行時に権限に関するエラーが出てしまいます。**  
権限を適宜付与してください。以下は一例です。
```
> chmod +x make_docker_image.sh
```
  
**Q. Dockerのイメージが作成されません。**  
タイムアウトで最後まで実行できない場合は、まずは再実行をしてみてください。それでも解決できない場合は、Dockerファイルにタイムアウトに関する設定を加える方法などを検討してみてください。  
warningが出ても期待通り作成され、動く場合があります。しかしそのような場合も必ず原因調査するようにしてください。(issue等で報告頂けると幸いです。)
  
**Q. 実行中のJupyterサーバーのURLが知りたいです。**  
以下のような形式になっているはずです。
```
http://localhost:40870/lab?token=<JUPYTER_TOKEN>
```
  
**Q. ipynbファイルで、同一ディレクトリにあるはずのモジュールをインポートできません。**  
Dockerfileの通り、Jupyterのカーネルはデフォルトで「/(ルートディレクトリ)」にいます。解決方法の一つとしては、ipynbファイル内でディレクトリをモジュールのある場所まで移動してください。以下は一例です。
```
import os

# 現在の作業ディレクトリを確認
print("Current Directory:", os.getcwd())

# ディレクトリ内のファイル一覧を表示
print("Files in the Directory:", os.listdir(os.getcwd()))

# 作業ディレクトリを変更
os.chdir('./working')

# モジュールをインポート
```
  
**Q. 「git add .」でステージングされないファイルやディレクトリがあります。**  
「add ファイル名(ディレクトリ)」でステージングしてみてください。

## 参考
https://link.springer.com/article/10.1007/s10845-023-02252-8

## さいごに
https://github.com/hirotadaS  
ベースとなるコード設計からちょっとしたご相談まで、先輩に大変お世話になりました。  
今後ともよろしくお願いいたします。